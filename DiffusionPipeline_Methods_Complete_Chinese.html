<!DOCTYPE html>
<html>
<head>
<title>DiffusionPipeline_Methods_Complete_Chinese.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="diffusionpipeline-%E7%B1%BB%E6%96%B9%E6%B3%95%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E5%AE%8C%E6%95%B4%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E7%89%88">DiffusionPipeline ç±»æ–¹æ³•è¯¦ç»†è¯´æ˜ï¼ˆå®Œæ•´ä¸­æ–‡ç¿»è¯‘ç‰ˆï¼‰</h1>
<h2 id="%E7%9B%AE%E5%BD%95">ç›®å½•</h2>
<ul>
<li><a href="#%E7%B1%BB%E5%B1%9E%E6%80%A7">ç±»å±æ€§</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95">æ ¸å¿ƒæ–¹æ³•</a></li>
<li><a href="#%E8%AE%BE%E5%A4%87%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86">è®¾å¤‡å’Œå†…å­˜ç®¡ç†</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E5%8A%9B%E4%BC%98%E5%8C%96">æ³¨æ„åŠ›ä¼˜åŒ–</a></li>
<li><a href="#vae%E4%BC%98%E5%8C%96">VAEä¼˜åŒ–</a></li>
<li><a href="#%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95">å·¥å…·æ–¹æ³•</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD">é«˜çº§åŠŸèƒ½</a></li>
</ul>
<h2 id="%E7%B1%BB%E5%B1%9E%E6%80%A7">ç±»å±æ€§</h2>
<h3 id="%E5%9F%BA%E7%A1%80%E5%B1%9E%E6%80%A7">åŸºç¡€å±æ€§</h3>
<table>
<thead>
<tr>
<th>å±æ€§å</th>
<th>ç±»å‹</th>
<th>é»˜è®¤å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>config_name</code></td>
<td><code>str</code></td>
<td><code>&quot;model_index.json&quot;</code></td>
<td>å­˜å‚¨æ‰©æ•£Pipelineæ‰€æœ‰ç»„ä»¶çš„ç±»åå’Œæ¨¡å—åçš„é…ç½®æ–‡ä»¶å</td>
</tr>
<tr>
<td><code>model_cpu_offload_seq</code></td>
<td><code>Optional[str]</code></td>
<td><code>None</code></td>
<td>æ¨¡å‹CPUå¸è½½åºåˆ—ï¼Œå®šä¹‰æ¨¡å‹å¸è½½é¡ºåº</td>
</tr>
<tr>
<td><code>hf_device_map</code></td>
<td><code>Optional[Dict]</code></td>
<td><code>None</code></td>
<td>HuggingFaceè®¾å¤‡æ˜ å°„é…ç½®</td>
</tr>
<tr>
<td><code>_optional_components</code></td>
<td><code>List[str]</code></td>
<td><code>[]</code></td>
<td>æ‰€æœ‰å¯é€‰ç»„ä»¶çš„åˆ—è¡¨ï¼Œè¿™äº›ç»„ä»¶ä¸å¿…ä¼ é€’ç»™Pipelineå³å¯è¿è¡Œï¼ˆåº”ç”±å­ç±»é‡å†™ï¼‰</td>
</tr>
<tr>
<td><code>_exclude_from_cpu_offload</code></td>
<td><code>List[str]</code></td>
<td><code>[]</code></td>
<td>ä»CPUå¸è½½ä¸­æ’é™¤çš„ç»„ä»¶åˆ—è¡¨</td>
</tr>
<tr>
<td><code>_load_connected_pipes</code></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>æ˜¯å¦åŠ è½½è¿æ¥çš„Pipeline</td>
</tr>
<tr>
<td><code>_is_onnx</code></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>æ˜¯å¦ä¸ºONNX Pipeline</td>
</tr>
</tbody>
</table>
<h2 id="%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95">æ ¸å¿ƒæ–¹æ³•</h2>
<h3 id="1-frompretrained-%E7%B1%BB%E6%96%B9%E6%B3%95">1. <code>from_pretrained</code> ç±»æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@classmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_pretrained</span><span class="hljs-params">(
    cls, 
    pretrained_model_name_or_path: Optional[Union[str, os.PathLike]], 
    **kwargs
)</span> -&gt; Self
</span></div></code></pre>
<p><strong>æè¿°</strong>: ä»é¢„è®­ç»ƒPipelineæƒé‡å®ä¾‹åŒ–PyTorchæ‰©æ•£Pipelineã€‚Pipelineé»˜è®¤è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ï¼ˆ<code>model.eval()</code>ï¼‰ã€‚</p>
<p><strong>æ ¸å¿ƒå‚æ•°</strong>:</p>
<ul>
<li><code>pretrained_model_name_or_path</code> (<code>str</code> æˆ– <code>os.PathLike</code>, å¯é€‰): å¯ä»¥æ˜¯ï¼š
<ul>
<li>å­—ç¬¦ä¸²ï¼Œæ‰˜ç®¡åœ¨Hubä¸Šçš„é¢„è®­ç»ƒPipelineçš„<em>ä»“åº“id</em>ï¼ˆä¾‹å¦‚<code>CompVis/ldm-text2im-large-256</code>ï¼‰</li>
<li>åŒ…å«ä½¿ç”¨<code>DiffusionPipeline.save_pretrained</code>ä¿å­˜çš„Pipelineæƒé‡çš„<em>ç›®å½•</em>è·¯å¾„ï¼ˆä¾‹å¦‚<code>./my_pipeline_directory/</code>ï¼‰</li>
<li>åŒ…å«ddufæ–‡ä»¶çš„<em>ç›®å½•</em>è·¯å¾„ï¼ˆä¾‹å¦‚<code>./my_pipeline_directory/</code>ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>æ•°æ®ç±»å‹å‚æ•°</strong>:</p>
<ul>
<li><code>torch_dtype</code> (<code>torch.dtype</code> æˆ– <code>dict[str, Union[str, torch.dtype]]</code>, å¯é€‰): è¦†ç›–é»˜è®¤çš„<code>torch.dtype</code>å¹¶ä½¿ç”¨å¦ä¸€ç§dtypeåŠ è½½æ¨¡å‹ã€‚è¦ä½¿ç”¨ä¸åŒdtypeåŠ è½½å­æ¨¡å‹ï¼Œè¯·ä¼ é€’dictï¼ˆä¾‹å¦‚<code>{'transformer': torch.bfloat16, 'vae': torch.float16}</code>ï¼‰ã€‚ä½¿ç”¨<code>default</code>ä¸ºæœªæŒ‡å®šçš„ç»„ä»¶è®¾ç½®é»˜è®¤dtypeï¼ˆä¾‹å¦‚<code>{'transformer': torch.bfloat16, 'default': torch.float16}</code>ï¼‰ã€‚å¦‚æœæœªæŒ‡å®šç»„ä»¶ä¸”æœªè®¾ç½®é»˜è®¤å€¼ï¼Œåˆ™ä½¿ç”¨<code>torch.float32</code>ã€‚</li>
</ul>
<p><strong>è‡ªå®šä¹‰Pipelineå‚æ•°</strong>:</p>
<ul>
<li><code>custom_pipeline</code> (<code>str</code>, å¯é€‰): ğŸ§ª è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œå¯èƒ½åœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ã€‚å¯ä»¥æ˜¯ï¼š
<ul>
<li>å­—ç¬¦ä¸²ï¼Œæ‰˜ç®¡åœ¨Hubä¸Šçš„è‡ªå®šä¹‰Pipelineçš„<em>ä»“åº“id</em>ï¼ˆä¾‹å¦‚<code>hf-internal-testing/diffusers-dummy-pipeline</code>ï¼‰ã€‚ä»“åº“å¿…é¡»åŒ…å«å®šä¹‰è‡ªå®šä¹‰Pipelineçš„<code>pipeline.py</code>æ–‡ä»¶ã€‚</li>
<li>å­—ç¬¦ä¸²ï¼Œæ‰˜ç®¡åœ¨GitHubä¸ŠCommunityä¸‹çš„ç¤¾åŒºPipelineçš„<em>æ–‡ä»¶å</em>ã€‚æœ‰æ•ˆæ–‡ä»¶åå¿…é¡»åŒ¹é…æ–‡ä»¶åè€Œä¸æ˜¯Pipelineè„šæœ¬ï¼ˆ<code>clip_guided_stable_diffusion</code>è€Œä¸æ˜¯<code>clip_guided_stable_diffusion.py</code>ï¼‰ã€‚ç¤¾åŒºPipelineå§‹ç»ˆä»GitHubçš„å½“å‰mainåˆ†æ”¯åŠ è½½ã€‚</li>
<li>åŒ…å«è‡ªå®šä¹‰Pipelineçš„ç›®å½•è·¯å¾„ï¼ˆ<code>./my_pipeline_directory/</code>ï¼‰ã€‚ç›®å½•å¿…é¡»åŒ…å«å®šä¹‰è‡ªå®šä¹‰Pipelineçš„<code>pipeline.py</code>æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä¸‹è½½æ§åˆ¶å‚æ•°</strong>:</p>
<ul>
<li><code>force_download</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): æ˜¯å¦å¼ºåˆ¶ï¼ˆé‡æ–°ï¼‰ä¸‹è½½æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ï¼Œè¦†ç›–ç¼“å­˜ç‰ˆæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</li>
<li><code>cache_dir</code> (<code>Union[str, os.PathLike]</code>, å¯é€‰): å¦‚æœä¸ä½¿ç”¨æ ‡å‡†ç¼“å­˜ï¼Œåˆ™ç¼“å­˜ä¸‹è½½çš„é¢„è®­ç»ƒæ¨¡å‹é…ç½®çš„ç›®å½•è·¯å¾„ã€‚</li>
<li><code>proxies</code> (<code>Dict[str, str]</code>, å¯é€‰): æŒ‰åè®®æˆ–ç«¯ç‚¹ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨å­—å…¸ï¼Œä¾‹å¦‚<code>{'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}</code>ã€‚ä»£ç†åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨ã€‚</li>
<li><code>output_loading_info</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): æ˜¯å¦è¿˜è¿”å›åŒ…å«ç¼ºå¤±é”®ã€æ„å¤–é”®å’Œé”™è¯¯æ¶ˆæ¯çš„å­—å…¸ã€‚</li>
<li><code>local_files_only</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): æ˜¯å¦ä»…åŠ è½½æœ¬åœ°æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º<code>True</code>ï¼Œæ¨¡å‹ä¸ä¼šä»Hubä¸‹è½½ã€‚</li>
<li><code>token</code> (<code>str</code> æˆ– <code>bool</code>, å¯é€‰): ç”¨ä½œè¿œç¨‹æ–‡ä»¶HTTP beareræˆæƒçš„ä»¤ç‰Œã€‚å¦‚æœä¸º<code>True</code>ï¼Œåˆ™ä½¿ç”¨ä»<code>diffusers-cli login</code>ç”Ÿæˆçš„ä»¤ç‰Œï¼ˆå­˜å‚¨åœ¨<code>~/.huggingface</code>ä¸­ï¼‰ã€‚</li>
<li><code>revision</code> (<code>str</code>, å¯é€‰, é»˜è®¤ä¸º <code>&quot;main&quot;</code>): è¦ä½¿ç”¨çš„ç‰¹å®šæ¨¡å‹ç‰ˆæœ¬ã€‚å¯ä»¥æ˜¯åˆ†æ”¯åç§°ã€æ ‡ç­¾åç§°ã€æäº¤idæˆ–Gitå…è®¸çš„ä»»ä½•æ ‡è¯†ç¬¦ã€‚</li>
<li><code>custom_revision</code> (<code>str</code>, å¯é€‰): è¦ä½¿ç”¨çš„ç‰¹å®šæ¨¡å‹ç‰ˆæœ¬ã€‚åœ¨ä»HubåŠ è½½è‡ªå®šä¹‰Pipelineæ—¶ï¼Œå¯ä»¥æ˜¯ç±»ä¼¼äº<code>revision</code>çš„åˆ†æ”¯åç§°ã€æ ‡ç­¾åç§°æˆ–æäº¤idã€‚é»˜è®¤ä¸ºæœ€æ–°ç¨³å®šçš„ğŸ¤— Diffusersç‰ˆæœ¬ã€‚</li>
<li><code>mirror</code> (<code>str</code>, å¯é€‰): é•œåƒæºï¼Œç”¨äºè§£å†³åœ¨ä¸­å›½ä¸‹è½½æ¨¡å‹æ—¶çš„å¯è®¿é—®æ€§é—®é¢˜ã€‚æˆ‘ä»¬ä¸ä¿è¯æºçš„åŠæ—¶æ€§æˆ–å®‰å…¨æ€§ï¼Œæ‚¨åº”è¯¥å‚è€ƒé•œåƒç«™ç‚¹è·å–æ›´å¤šä¿¡æ¯ã€‚</li>
</ul>
<p><strong>è®¾å¤‡æ˜ å°„å‚æ•°</strong>:</p>
<ul>
<li><code>device_map</code> (<code>str</code>, å¯é€‰): æŒ‡ç¤ºPipelineçš„ä¸åŒç»„ä»¶åº”å¦‚ä½•æ”¾ç½®åœ¨å¯ç”¨è®¾å¤‡ä¸Šçš„ç­–ç•¥ã€‚ç›®å‰ä»…æ”¯æŒ&quot;balanced&quot; <code>device_map</code>ã€‚æŸ¥çœ‹<a href="https://huggingface.co/docs/diffusers/main/en/tutorials/inference_with_big_models#device-placement">æ­¤é“¾æ¥</a>äº†è§£æ›´å¤šä¿¡æ¯ã€‚</li>
<li><code>max_memory</code> (<code>Dict</code>, å¯é€‰): è®¾å¤‡æ ‡è¯†ç¬¦çš„æœ€å¤§å†…å­˜å­—å…¸ã€‚å¦‚æœæœªè®¾ç½®ï¼Œå°†é»˜è®¤ä¸ºæ¯ä¸ªGPUçš„æœ€å¤§å¯ç”¨å†…å­˜å’Œå¯ç”¨çš„CPU RAMã€‚</li>
<li><code>offload_folder</code> (<code>str</code> æˆ– <code>os.PathLike</code>, å¯é€‰): å¦‚æœdevice_mapåŒ…å«å€¼<code>&quot;disk&quot;</code>ï¼Œåˆ™å¸è½½æƒé‡çš„è·¯å¾„ã€‚</li>
<li><code>offload_state_dict</code> (<code>bool</code>, å¯é€‰): å¦‚æœä¸º<code>True</code>ï¼Œä¸´æ—¶å°†CPUçŠ¶æ€å­—å…¸å¸è½½åˆ°ç¡¬ç›˜ï¼Œä»¥é¿å…åœ¨CPUçŠ¶æ€å­—å…¸çš„æƒé‡+æ£€æŸ¥ç‚¹æœ€å¤§åˆ†ç‰‡ä¸é€‚åˆæ—¶è€—å°½CPU RAMã€‚å½“æœ‰ä¸€äº›ç£ç›˜å¸è½½æ—¶é»˜è®¤ä¸º<code>True</code>ã€‚</li>
</ul>
<p><strong>å†…å­˜ä¼˜åŒ–å‚æ•°</strong>:</p>
<ul>
<li><code>low_cpu_mem_usage</code> (<code>bool</code>, å¯é€‰, å¦‚æœtorchç‰ˆæœ¬&gt;=1.9.0åˆ™é»˜è®¤ä¸º <code>True</code>ï¼Œå¦åˆ™ä¸º <code>False</code>): ä»…åŠ è½½é¢„è®­ç»ƒæƒé‡è€Œä¸åˆå§‹åŒ–æƒé‡æ¥åŠ é€Ÿæ¨¡å‹åŠ è½½ã€‚è¿™ä¹Ÿå°è¯•åœ¨åŠ è½½æ¨¡å‹æ—¶ä¸ä½¿ç”¨è¶…è¿‡1xæ¨¡å‹å¤§å°çš„CPUå†…å­˜ï¼ˆåŒ…æ‹¬å³°å€¼å†…å­˜ï¼‰ã€‚ä»…æ”¯æŒPyTorch &gt;= 1.9.0ã€‚å¦‚æœæ‚¨ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„PyTorchï¼Œå°†æ­¤å‚æ•°è®¾ç½®ä¸º<code>True</code>å°†å¼•å‘é”™è¯¯ã€‚</li>
<li><code>use_safetensors</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>None</code>): å¦‚æœè®¾ç½®ä¸º<code>None</code>ï¼Œå¦‚æœsafetensorsæƒé‡å¯ç”¨<strong>ä¸”</strong>å®‰è£…äº†safetensorsåº“ï¼Œåˆ™ä¸‹è½½safetensorsæƒé‡ã€‚å¦‚æœè®¾ç½®ä¸º<code>True</code>ï¼Œæ¨¡å‹å¼ºåˆ¶ä»safetensorsæƒé‡åŠ è½½ã€‚å¦‚æœè®¾ç½®ä¸º<code>False</code>ï¼Œä¸åŠ è½½safetensorsæƒé‡ã€‚</li>
<li><code>use_onnx</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>None</code>): å¦‚æœè®¾ç½®ä¸º<code>True</code>ï¼Œå¦‚æœå­˜åœ¨ONNXæƒé‡ï¼Œå°†å§‹ç»ˆä¸‹è½½ã€‚å¦‚æœè®¾ç½®ä¸º<code>False</code>ï¼Œæ°¸è¿œä¸ä¼šä¸‹è½½ONNXæƒé‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>use_onnx</code>é»˜è®¤ä¸º<code>_is_onnx</code>ç±»å±æ€§ï¼Œå¯¹äºéONNX Pipelineä¸º<code>False</code>ï¼Œå¯¹äºONNX Pipelineä¸º<code>True</code>ã€‚ONNXæƒé‡åŒ…æ‹¬ä»¥<code>.onnx</code>å’Œ<code>.pb</code>ç»“å°¾çš„æ–‡ä»¶ã€‚</li>
<li><code>variant</code> (<code>str</code>, å¯é€‰): ä»æŒ‡å®šçš„å˜ä½“æ–‡ä»¶ååŠ è½½æƒé‡ï¼Œå¦‚<code>&quot;fp16&quot;</code>æˆ–<code>&quot;ema&quot;</code>ã€‚ä»<code>from_flax</code>åŠ è½½æ—¶å¿½ç•¥æ­¤é¡¹ã€‚</li>
<li><code>dduf_file</code> (<code>str</code>, å¯é€‰): ä»æŒ‡å®šçš„ddufæ–‡ä»¶åŠ è½½æƒé‡ã€‚</li>
</ul>
<p><strong>å…¶ä»–å‚æ•°</strong>:</p>
<ul>
<li><code>kwargs</code> (å‰©ä½™çš„å…³é”®å­—å‚æ•°å­—å…¸, å¯é€‰): å¯ç”¨äºè¦†ç›–åŠ è½½å’Œå¯ä¿å­˜å˜é‡ï¼ˆç‰¹å®šPipelineç±»çš„Pipelineç»„ä»¶ï¼‰ã€‚è¦†ç›–çš„ç»„ä»¶ç›´æ¥ä¼ é€’ç»™Pipelineçš„<code>__init__</code>æ–¹æ³•ã€‚è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹äº†è§£æ›´å¤šä¿¡æ¯ã€‚</li>
</ul>
<p><strong>æç¤º</strong>: è¦ä½¿ç”¨ç§æœ‰æˆ–<a href="https://huggingface.co/docs/hub/models-gated#gated-models">é—¨æ§</a>æ¨¡å‹ï¼Œè¯·ä½¿ç”¨<code>hf auth login</code>ç™»å½•ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> DiffusionPipeline

<span class="hljs-comment"># ä»huggingface.coä¸‹è½½å¹¶ç¼“å­˜Pipeline</span>
pipeline = DiffusionPipeline.from_pretrained(<span class="hljs-string">"CompVis/ldm-text2im-large-256"</span>)

<span class="hljs-comment"># ä¸‹è½½éœ€è¦æˆæƒä»¤ç‰Œçš„Pipeline</span>
<span class="hljs-comment"># æœ‰å…³è®¿é—®ä»¤ç‰Œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ–‡æ¡£çš„æ­¤éƒ¨åˆ†</span>
<span class="hljs-comment"># https://huggingface.co/docs/hub/security-tokens</span>
pipeline = DiffusionPipeline.from_pretrained(<span class="hljs-string">"stable-diffusion-v1-5/stable-diffusion-v1-5"</span>)

<span class="hljs-comment"># ä½¿ç”¨ä¸åŒçš„è°ƒåº¦å™¨</span>
<span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> LMSDiscreteScheduler

scheduler = LMSDiscreteScheduler.from_config(pipeline.scheduler.config)
pipeline.scheduler = scheduler
</div></code></pre>
<hr>
<h3 id="2-savepretrained-%E6%96%B9%E6%B3%95">2. <code>save_pretrained</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_pretrained</span><span class="hljs-params">(
    self,
    save_directory: Union[str, os.PathLike],
    safe_serialization: bool = True,
    variant: Optional[str] = None,
    max_shard_size: Optional[Union[int, str]] = None,
    push_to_hub: bool = False,
    **kwargs
)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å°†Pipelineçš„æ‰€æœ‰å¯ä¿å­˜å˜é‡ä¿å­˜åˆ°ç›®å½•ä¸­ã€‚å¦‚æœPipelineå˜é‡çš„ç±»å®ç°äº†ä¿å­˜å’ŒåŠ è½½æ–¹æ³•ï¼Œåˆ™å¯ä»¥ä¿å­˜å’ŒåŠ è½½è¯¥å˜é‡ã€‚å¯ä»¥ä½¿ç”¨<code>DiffusionPipeline.from_pretrained</code>ç±»æ–¹æ³•è½»æ¾é‡æ–°åŠ è½½Pipelineã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>save_directory</code> (<code>str</code> æˆ– <code>os.PathLike</code>): ä¿å­˜Pipelineçš„ç›®å½•ã€‚å¦‚æœä¸å­˜åœ¨å°†è¢«åˆ›å»ºã€‚</li>
<li><code>safe_serialization</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>True</code>): æ˜¯å¦ä½¿ç”¨<code>safetensors</code>ä¿å­˜æ¨¡å‹ï¼Œæˆ–ä½¿ç”¨ä¼ ç»Ÿçš„PyTorchæ–¹å¼ä¸<code>pickle</code>ã€‚</li>
<li><code>variant</code> (<code>str</code>, å¯é€‰): å¦‚æœæŒ‡å®šï¼Œæƒé‡å°†ä»¥<code>pytorch_model.&lt;variant&gt;.bin</code>æ ¼å¼ä¿å­˜ã€‚</li>
<li><code>max_shard_size</code> (<code>int</code> æˆ– <code>str</code>, é»˜è®¤ä¸º <code>None</code>): åˆ†ç‰‡å‰æ£€æŸ¥ç‚¹çš„æœ€å¤§å¤§å°ã€‚åˆ†ç‰‡åçš„æ£€æŸ¥ç‚¹å°†å°äºæ­¤å¤§å°ã€‚å¦‚æœè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ï¼Œéœ€è¦æ˜¯æ•°å­—åè·Ÿå•ä½ï¼ˆå¦‚<code>&quot;5GB&quot;</code>ï¼‰ã€‚å¦‚æœè¡¨ç¤ºä¸ºæ•´æ•°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚è¯·æ³¨æ„ï¼Œæ­¤é™åˆ¶å°†åœ¨ä¸€å®šæ—¶é—´åï¼ˆä»2024å¹´10æœˆå¼€å§‹ï¼‰é™ä½ï¼Œä»¥å…è®¸ç”¨æˆ·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„<code>diffusers</code>ã€‚è¿™æ˜¯ä¸ºäº†åœ¨Hugging Faceç”Ÿæ€ç³»ç»Ÿçš„ä¸åŒåº“ï¼ˆä¾‹å¦‚<code>transformers</code>å’Œ<code>accelerate</code>ï¼‰ä¸­ä¸ºæ­¤å‚æ•°å»ºç«‹é€šç”¨é»˜è®¤å¤§å°ã€‚</li>
<li><code>push_to_hub</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): ä¿å­˜åæ˜¯å¦å°†æ¨¡å‹æ¨é€åˆ°Hugging Faceæ¨¡å‹ä¸­å¿ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>repo_id</code>æŒ‡å®šè¦æ¨é€åˆ°çš„ä»“åº“ï¼ˆé»˜è®¤ä¸ºæ‚¨å‘½åç©ºé—´ä¸­çš„<code>save_directory</code>åç§°ï¼‰ã€‚</li>
<li><code>kwargs</code> (<code>Dict[str, Any]</code>, å¯é€‰): ä¼ é€’ç»™<code>utils.PushToHubMixin.push_to_hub</code>æ–¹æ³•çš„é¢å¤–å…³é”®å­—å‚æ•°ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># åŸºç¡€ä¿å­˜</span>
pipeline.save_pretrained(<span class="hljs-string">"./my_pipeline"</span>)

<span class="hljs-comment"># ä¿å­˜fp16å˜ä½“å¹¶æ¨é€åˆ°Hub</span>
pipeline.save_pretrained(
    <span class="hljs-string">"./my_pipeline"</span>,
    variant=<span class="hljs-string">"fp16"</span>,
    push_to_hub=<span class="hljs-literal">True</span>,
    repo_id=<span class="hljs-string">"my_username/my_pipeline"</span>
)
</div></code></pre>
<hr>
<h3 id="3-to-%E6%96%B9%E6%B3%95">3. <code>to</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to</span><span class="hljs-params">(self, *args, **kwargs)</span> -&gt; Self
</span></div></code></pre>
<p><strong>æè¿°</strong>: æ‰§è¡ŒPipeline dtypeå’Œ/æˆ–è®¾å¤‡è½¬æ¢ã€‚ä»<code>self.to(*args, **kwargs)</code>çš„å‚æ•°æ¨æ–­torch.dtypeå’Œtorch.deviceã€‚</p>
<p><strong>æç¤º</strong>: å¦‚æœPipelineå·²ç»å…·æœ‰æ­£ç¡®çš„torch.dtypeå’Œtorch.deviceï¼Œåˆ™æŒ‰åŸæ ·è¿”å›ã€‚å¦åˆ™ï¼Œè¿”å›çš„Pipelineæ˜¯å…·æœ‰æ‰€éœ€torch.dtypeå’Œtorch.deviceçš„selfçš„å‰¯æœ¬ã€‚</p>
<p><strong>è°ƒç”¨æ–¹å¼</strong>:</p>
<ul>
<li><code>to(dtype, silence_dtype_warnings=False) â†’ DiffusionPipeline</code> è¿”å›å…·æœ‰æŒ‡å®šdtypeçš„Pipeline</li>
<li><code>to(device, silence_dtype_warnings=False) â†’ DiffusionPipeline</code> è¿”å›å…·æœ‰æŒ‡å®šdeviceçš„Pipeline</li>
<li><code>to(device=None, dtype=None, silence_dtype_warnings=False) â†’ DiffusionPipeline</code> è¿”å›å…·æœ‰æŒ‡å®šdeviceå’Œdtypeçš„Pipeline</li>
</ul>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>dtype</code> (<code>torch.dtype</code>, å¯é€‰): è¿”å›å…·æœ‰æŒ‡å®šdtypeçš„Pipeline</li>
<li><code>device</code> (<code>torch.Device</code>, å¯é€‰): è¿”å›å…·æœ‰æŒ‡å®šdeviceçš„Pipeline</li>
<li><code>silence_dtype_warnings</code> (<code>str</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): å¦‚æœç›®æ ‡<code>dtype</code>ä¸ç›®æ ‡<code>device</code>ä¸å…¼å®¹ï¼Œæ˜¯å¦çœç•¥è­¦å‘Šã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># ç§»åŠ¨åˆ°GPU</span>
pipeline = pipeline.to(<span class="hljs-string">"cuda"</span>)

<span class="hljs-comment"># è½¬æ¢æ•°æ®ç±»å‹</span>
pipeline = pipeline.to(torch.float16)

<span class="hljs-comment"># åŒæ—¶è½¬æ¢è®¾å¤‡å’Œæ•°æ®ç±»å‹</span>
pipeline = pipeline.to(<span class="hljs-string">"cuda"</span>, torch.float16)
</div></code></pre>
<h2 id="%E8%AE%BE%E5%A4%87%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86">è®¾å¤‡å’Œå†…å­˜ç®¡ç†</h2>
<h3 id="4-enablemodelcpuoffload-%E6%96%B9%E6%B3%95">4. <code>enable_model_cpu_offload</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_model_cpu_offload</span><span class="hljs-params">(self, gpu_id: Optional[int] = None, device: Union[torch.device, str] = None)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: ä½¿ç”¨accelerateå°†æ‰€æœ‰æ¨¡å‹å¸è½½åˆ°CPUï¼Œä»¥è¾ƒä½çš„æ€§èƒ½å½±å“å‡å°‘å†…å­˜ä½¿ç”¨ã€‚ä¸<code>enable_sequential_cpu_offload</code>ç›¸æ¯”ï¼Œæ­¤æ–¹æ³•åœ¨è°ƒç”¨å…¶<code>forward</code>æ–¹æ³•æ—¶å°†ä¸€ä¸ªå®Œæ•´æ¨¡å‹ç§»åŠ¨åˆ°åŠ é€Ÿå™¨ï¼Œæ¨¡å‹ä¿æŒåœ¨åŠ é€Ÿå™¨ä¸Šç›´åˆ°ä¸‹ä¸€ä¸ªæ¨¡å‹è¿è¡Œã€‚å†…å­˜èŠ‚çœä½äº<code>enable_sequential_cpu_offload</code>ï¼Œä½†ç”±äº<code>unet</code>çš„è¿­ä»£æ‰§è¡Œï¼Œæ€§èƒ½è¦å¥½å¾—å¤šã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>gpu_id</code> (<code>int</code>, å¯é€‰): æ¨ç†ä¸­åº”ä½¿ç”¨çš„åŠ é€Ÿå™¨çš„IDã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†é»˜è®¤ä¸º0ã€‚</li>
<li><code>device</code> (<code>torch.Device</code> æˆ– <code>str</code>, å¯é€‰, é»˜è®¤ä¸ºNone): æ¨ç†ä¸­åº”ä½¿ç”¨çš„åŠ é€Ÿå™¨çš„PyTorchè®¾å¤‡ç±»å‹ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†è‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„åŠ é€Ÿå™¨å¹¶ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># ä½¿ç”¨é»˜è®¤GPU</span>
pipeline.enable_model_cpu_offload()

<span class="hljs-comment"># æŒ‡å®šGPU ID</span>
pipeline.enable_model_cpu_offload(gpu_id=<span class="hljs-number">1</span>)

<span class="hljs-comment"># æŒ‡å®šè®¾å¤‡</span>
pipeline.enable_model_cpu_offload(device=<span class="hljs-string">"cuda:1"</span>)
</div></code></pre>
<hr>
<h3 id="5-enablesequentialcpuoffload-%E6%96%B9%E6%B3%95">5. <code>enable_sequential_cpu_offload</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_sequential_cpu_offload</span><span class="hljs-params">(self, gpu_id: Optional[int] = None, device: Union[torch.device, str] = None)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: ä½¿ç”¨ğŸ¤— Accelerateå°†æ‰€æœ‰æ¨¡å‹å¸è½½åˆ°CPUï¼Œæ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨ã€‚è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰<code>torch.nn.Module</code>ç»„ä»¶ï¼ˆé™¤äº†<code>self._exclude_from_cpu_offload</code>ä¸­çš„ç»„ä»¶ï¼‰çš„çŠ¶æ€å­—å…¸ä¿å­˜åˆ°CPUï¼Œç„¶åç§»åŠ¨åˆ°<code>torch.device('meta')</code>ï¼Œä»…åœ¨è°ƒç”¨å…¶ç‰¹å®šå­æ¨¡å—çš„<code>forward</code>æ–¹æ³•æ—¶åŠ è½½åˆ°åŠ é€Ÿå™¨ã€‚å¸è½½å‘ç”Ÿåœ¨å­æ¨¡å—åŸºç¡€ä¸Šã€‚å†…å­˜èŠ‚çœé«˜äº<code>enable_model_cpu_offload</code>ï¼Œä½†æ€§èƒ½è¾ƒä½ã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>gpu_id</code> (<code>int</code>, å¯é€‰): æ¨ç†ä¸­åº”ä½¿ç”¨çš„åŠ é€Ÿå™¨çš„IDã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†é»˜è®¤ä¸º0ã€‚</li>
<li><code>device</code> (<code>torch.Device</code> æˆ– <code>str</code>, å¯é€‰, é»˜è®¤ä¸ºNone): æ¨ç†ä¸­åº”ä½¿ç”¨çš„åŠ é€Ÿå™¨çš„PyTorchè®¾å¤‡ç±»å‹ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†è‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„åŠ é€Ÿå™¨å¹¶ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># å¯ç”¨é¡ºåºCPUå¸è½½</span>
pipeline.enable_sequential_cpu_offload()

<span class="hljs-comment"># æŒ‡å®šè®¾å¤‡</span>
pipeline.enable_sequential_cpu_offload(device=<span class="hljs-string">"cuda:0"</span>)
</div></code></pre>
<h2 id="%E6%B3%A8%E6%84%8F%E5%8A%9B%E4%BC%98%E5%8C%96">æ³¨æ„åŠ›ä¼˜åŒ–</h2>
<h3 id="6-enablexformersmemoryefficientattention-%E6%96%B9%E6%B3%95">6. <code>enable_xformers_memory_efficient_attention</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_xformers_memory_efficient_attention</span><span class="hljs-params">(self, attention_op: Optional[Callable] = None)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å¯ç”¨æ¥è‡ª<a href="https://facebookresearch.github.io/xformers/">xFormers</a>çš„å†…å­˜é«˜æ•ˆæ³¨æ„åŠ›ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œæ‚¨åº”è¯¥è§‚å¯Ÿåˆ°æ›´ä½çš„GPUå†…å­˜ä½¿ç”¨å’Œæ¨ç†æœŸé—´çš„æ½œåœ¨åŠ é€Ÿã€‚ä¸ä¿è¯è®­ç»ƒæœŸé—´çš„åŠ é€Ÿã€‚</p>
<p><strong>è­¦å‘Š</strong>: âš ï¸ å½“å†…å­˜é«˜æ•ˆæ³¨æ„åŠ›å’Œåˆ‡ç‰‡æ³¨æ„åŠ›éƒ½å¯ç”¨æ—¶ï¼Œå†…å­˜é«˜æ•ˆæ³¨æ„åŠ›ä¼˜å…ˆã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>attention_op</code> (<code>Callable</code>, å¯é€‰): è¦†ç›–é»˜è®¤çš„<code>None</code>æ“ä½œç¬¦ï¼Œç”¨ä½œxFormersçš„<a href="https://facebookresearch.github.io/xformers/components/ops.html#xformers.ops.memory_efficient_attention"><code>memory_efficient_attention()</code></a>å‡½æ•°çš„<code>op</code>å‚æ•°ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> DiffusionPipeline
<span class="hljs-keyword">from</span> xformers.ops <span class="hljs-keyword">import</span> MemoryEfficientAttentionFlashAttentionOp

pipe = DiffusionPipeline.from_pretrained(<span class="hljs-string">"stabilityai/stable-diffusion-2-1"</span>, torch_dtype=torch.float16)
pipe = pipe.to(<span class="hljs-string">"cuda"</span>)
pipe.enable_xformers_memory_efficient_attention(attention_op=MemoryEfficientAttentionFlashAttentionOp)
<span class="hljs-comment"># é’ˆå¯¹ä¸æ¥å—Flash Attentionæ³¨æ„åŠ›å½¢çŠ¶çš„VAEçš„å˜é€šæ–¹æ¡ˆ</span>
pipe.vae.enable_xformers_memory_efficient_attention(attention_op=<span class="hljs-literal">None</span>)
</div></code></pre>
<hr>
<h3 id="7-enableattentionslicing-%E6%96%B9%E6%B3%95">7. <code>enable_attention_slicing</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_attention_slicing</span><span class="hljs-params">(self, slice_size: Optional[Union[str, int]] = <span class="hljs-string">"auto"</span>)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å¯ç”¨åˆ‡ç‰‡æ³¨æ„åŠ›è®¡ç®—ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œæ³¨æ„åŠ›æ¨¡å—å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆåˆ‡ç‰‡ï¼Œåˆ†å‡ ä¸ªæ­¥éª¤è®¡ç®—æ³¨æ„åŠ›ã€‚å¯¹äºå¤šä¸ªæ³¨æ„åŠ›å¤´ï¼Œè®¡ç®—åœ¨æ¯ä¸ªå¤´ä¸Šé¡ºåºæ‰§è¡Œã€‚è¿™å¯¹äºä»¥å°çš„é€Ÿåº¦é™ä½ä¸ºä»£ä»·èŠ‚çœä¸€äº›å†…å­˜å¾ˆæœ‰ç”¨ã€‚</p>
<p><strong>è­¦å‘Š</strong>: âš ï¸ å¦‚æœæ‚¨å·²ç»ä½¿ç”¨PyTorch 2.0çš„<code>scaled_dot_product_attention</code>(SDPA)æˆ–xFormersï¼Œè¯·ä¸è¦å¯ç”¨æ³¨æ„åŠ›åˆ‡ç‰‡ã€‚è¿™äº›æ³¨æ„åŠ›è®¡ç®—å·²ç»éå¸¸å†…å­˜é«˜æ•ˆï¼Œå› æ­¤æ‚¨ä¸éœ€è¦å¯ç”¨æ­¤åŠŸèƒ½ã€‚å¦‚æœæ‚¨åœ¨ä½¿ç”¨SDPAæˆ–xFormersæ—¶å¯ç”¨æ³¨æ„åŠ›åˆ‡ç‰‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„å‡é€Ÿï¼</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>slice_size</code> (<code>str</code> æˆ– <code>int</code>, å¯é€‰, é»˜è®¤ä¸º <code>&quot;auto&quot;</code>): å½“ä¸º<code>&quot;auto&quot;</code>æ—¶ï¼Œå°†æ³¨æ„åŠ›å¤´çš„è¾“å…¥å‡åŠï¼Œå› æ­¤æ³¨æ„åŠ›å°†åˆ†ä¸¤æ­¥è®¡ç®—ã€‚å¦‚æœä¸º<code>&quot;max&quot;</code>ï¼Œé€šè¿‡ä¸€æ¬¡åªè¿è¡Œä¸€ä¸ªåˆ‡ç‰‡æ¥èŠ‚çœæœ€å¤§å†…å­˜ã€‚å¦‚æœæä¾›æ•°å­—ï¼Œåˆ™ä½¿ç”¨<code>attention_head_dim // slice_size</code>ä¸ªåˆ‡ç‰‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>attention_head_dim</code>å¿…é¡»æ˜¯<code>slice_size</code>çš„å€æ•°ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> StableDiffusionPipeline

pipe = StableDiffusionPipeline.from_pretrained(
    <span class="hljs-string">"stable-diffusion-v1-5/stable-diffusion-v1-5"</span>,
    torch_dtype=torch.float16,
    use_safetensors=<span class="hljs-literal">True</span>,
)

prompt = <span class="hljs-string">"a photo of an astronaut riding a horse on mars"</span>
pipe.enable_attention_slicing()
image = pipe(prompt).images[<span class="hljs-number">0</span>]
</div></code></pre>
<h2 id="vae%E4%BC%98%E5%8C%96">VAEä¼˜åŒ–</h2>
<h3 id="8-enablevaeslicing-%E6%96%B9%E6%B3%95">8. <code>enable_vae_slicing</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_vae_slicing</span><span class="hljs-params">(self)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å¯ç”¨åˆ‡ç‰‡VAEè§£ç ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAEå°†è¾“å…¥å¼ é‡åˆ†å‰²æˆåˆ‡ç‰‡ï¼Œåˆ†å‡ ä¸ªæ­¥éª¤è®¡ç®—è§£ç ã€‚è¿™å¯¹äºèŠ‚çœä¸€äº›å†…å­˜å’Œå…è®¸æ›´å¤§çš„æ‰¹æ¬¡å¤§å°å¾ˆæœ‰ç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># å¯ç”¨VAEåˆ‡ç‰‡</span>
pipeline.enable_vae_slicing()
</div></code></pre>
<hr>
<h3 id="9-enablevaetiling-%E6%96%B9%E6%B3%95">9. <code>enable_vae_tiling</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_vae_tiling</span><span class="hljs-params">(self)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å¯ç”¨å¹³é“ºVAEè§£ç ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAEå°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç“¦ç‰‡ï¼Œåˆ†å‡ ä¸ªæ­¥éª¤è®¡ç®—è§£ç å’Œç¼–ç ã€‚è¿™å¯¹äºèŠ‚çœå¤§é‡å†…å­˜å’Œå…è®¸å¤„ç†æ›´å¤§å›¾åƒéå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># å¯ç”¨VAEå¹³é“º</span>
pipeline.enable_vae_tiling()
</div></code></pre>
<h2 id="%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD">é«˜çº§åŠŸèƒ½</h2>
<h3 id="10-enablefreeu-%E6%96%B9%E6%B3%95">10. <code>enable_freeu</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enable_freeu</span><span class="hljs-params">(self, s1: float, s2: float, b1: float, b2: float)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å¯ç”¨FreeUæœºåˆ¶ï¼Œå¦‚https://huggingface.co/papers/2309.11497æ‰€è¿°ã€‚ç¼©æ”¾å› å­åçš„åç¼€è¡¨ç¤ºåº”ç”¨çš„é˜¶æ®µã€‚</p>
<p>è¯·å‚è€ƒ<a href="https://github.com/ChenyangSi/FreeU">å®˜æ–¹ä»“åº“</a>è·å–å·²çŸ¥é€‚ç”¨äºä¸åŒPipelineï¼ˆå¦‚Stable Diffusion v1ã€v2å’ŒStable Diffusion XLï¼‰çš„å€¼ç»„åˆã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>s1</code> (<code>float</code>): é˜¶æ®µ1çš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è·ƒç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„&quot;è¿‡åº¦å¹³æ»‘æ•ˆåº”&quot;ã€‚</li>
<li><code>s2</code> (<code>float</code>): é˜¶æ®µ2çš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è·ƒç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„&quot;è¿‡åº¦å¹³æ»‘æ•ˆåº”&quot;ã€‚</li>
<li><code>b1</code> (<code>float</code>): é˜¶æ®µ1çš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§éª¨å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚</li>
<li><code>b2</code> (<code>float</code>): é˜¶æ®µ2çš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§éª¨å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Stable Diffusion v1.5æ¨èå€¼</span>
pipeline.enable_freeu(s1=<span class="hljs-number">0.9</span>, s2=<span class="hljs-number">0.2</span>, b1=<span class="hljs-number">1.2</span>, b2=<span class="hljs-number">1.4</span>)

<span class="hljs-comment"># Stable Diffusion XLæ¨èå€¼</span>
pipeline.enable_freeu(s1=<span class="hljs-number">0.6</span>, s2=<span class="hljs-number">0.4</span>, b1=<span class="hljs-number">1.1</span>, b2=<span class="hljs-number">1.2</span>)
</div></code></pre>
<hr>
<h3 id="11-fuseqkvprojections-%E6%96%B9%E6%B3%95">11. <code>fuse_qkv_projections</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fuse_qkv_projections</span><span class="hljs-params">(self, unet: bool = True, vae: bool = True)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å¯ç”¨èåˆQKVæŠ•å½±ã€‚å¯¹äºè‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œæ‰€æœ‰æŠ•å½±çŸ©é˜µï¼ˆå³æŸ¥è¯¢ã€é”®ã€å€¼ï¼‰éƒ½è¢«èåˆã€‚å¯¹äºäº¤å‰æ³¨æ„åŠ›æ¨¡å—ï¼Œé”®å’Œå€¼æŠ•å½±çŸ©é˜µè¢«èåˆã€‚</p>
<p><strong>è­¦å‘Š</strong>: ğŸ§ª è¿™æ˜¯å®éªŒæ€§APIã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>unet</code> (<code>bool</code>, é»˜è®¤ä¸º <code>True</code>): åœ¨UNetä¸Šåº”ç”¨èåˆã€‚</li>
<li><code>vae</code> (<code>bool</code>, é»˜è®¤ä¸º <code>True</code>): åœ¨VAEä¸Šåº”ç”¨èåˆã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># èåˆUNetå’ŒVAEçš„QKVæŠ•å½±</span>
pipeline.fuse_qkv_projections()

<span class="hljs-comment"># ä»…èåˆUNet</span>
pipeline.fuse_qkv_projections(unet=<span class="hljs-literal">True</span>, vae=<span class="hljs-literal">False</span>)
</div></code></pre>
<h2 id="%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95">å·¥å…·æ–¹æ³•</h2>
<h3 id="12-progressbar-%E6%96%B9%E6%B3%95">12. <code>progress_bar</code> æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">progress_bar</span><span class="hljs-params">(self, iterable=None, total=None)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: åˆ›å»ºè¿›åº¦æ¡ç”¨äºæ˜¾ç¤ºæ¨ç†è¿›åº¦ã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>iterable</code> (å¯é€‰): å¯è¿­ä»£å¯¹è±¡ï¼Œç”¨äºåŒ…è£…è¿›åº¦æ¡</li>
<li><code>total</code> (å¯é€‰): æ€»æ­¥æ•°ï¼Œç”¨äºåˆ›å»ºæ‰‹åŠ¨æ›´æ–°çš„è¿›åº¦æ¡</li>
</ul>
<p><strong>æ³¨æ„</strong>: å¿…é¡»å®šä¹‰<code>total</code>æˆ–<code>iterable</code>ä¸­çš„ä¸€ä¸ªã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># åŒ…è£…å¯è¿­ä»£å¯¹è±¡</span>
<span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> pipeline.progress_bar(range(<span class="hljs-number">50</span>)):
    <span class="hljs-comment"># æ‰§è¡Œæ¨ç†æ­¥éª¤</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># æ‰‹åŠ¨è¿›åº¦æ¡</span>
pbar = pipeline.progress_bar(total=<span class="hljs-number">50</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">50</span>):
    <span class="hljs-comment"># æ‰§è¡Œæ“ä½œ</span>
    pbar.update(<span class="hljs-number">1</span>)
</div></code></pre>
<hr>
<h3 id="13-numpytopil-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95">13. <code>numpy_to_pil</code> é™æ€æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">numpy_to_pil</span><span class="hljs-params">(images)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: å°†NumPyå›¾åƒæˆ–å›¾åƒæ‰¹æ¬¡è½¬æ¢ä¸ºPILå›¾åƒã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>images</code>: NumPyæ•°ç»„æ ¼å¼çš„å›¾åƒ</li>
</ul>
<p><strong>è¿”å›å€¼</strong>: PILå›¾åƒåˆ—è¡¨</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># è½¬æ¢NumPyå›¾åƒä¸ºPIL</span>
numpy_images = np.random.rand(<span class="hljs-number">2</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">3</span>)
pil_images = DiffusionPipeline.numpy_to_pil(numpy_images)
</div></code></pre>
<hr>
<h3 id="14-frompipe-%E7%B1%BB%E6%96%B9%E6%B3%95">14. <code>from_pipe</code> ç±»æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@classmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_pipe</span><span class="hljs-params">(cls, pipeline, **kwargs)</span>
</span></div></code></pre>
<p><strong>æè¿°</strong>: ä»ç»™å®šPipelineåˆ›å»ºæ–°Pipelineã€‚æ­¤æ–¹æ³•å¯¹äºä»ç°æœ‰Pipelineç»„ä»¶åˆ›å»ºæ–°Pipelineè€Œä¸é‡æ–°åˆ†é…é¢å¤–å†…å­˜å¾ˆæœ‰ç”¨ã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>pipeline</code> (<code>DiffusionPipeline</code>): è¦ä»ä¸­åˆ›å»ºæ–°Pipelineçš„Pipelineã€‚</li>
</ul>
<p><strong>è¿”å›å€¼</strong>: <code>DiffusionPipeline</code>: å…·æœ‰ä¸<code>pipeline</code>ç›¸åŒæƒé‡å’Œé…ç½®çš„æ–°Pipelineã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> StableDiffusionPipeline, StableDiffusionSAGPipeline

pipe = StableDiffusionPipeline.from_pretrained(<span class="hljs-string">"stable-diffusion-v1-5/stable-diffusion-v1-5"</span>)
new_pipe = StableDiffusionSAGPipeline.from_pipe(pipe)
</div></code></pre>
<hr>
<h3 id="15-download-%E7%B1%BB%E6%96%B9%E6%B3%95">15. <code>download</code> ç±»æ–¹æ³•</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@classmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download</span><span class="hljs-params">(cls, pretrained_model_name, **kwargs)</span> -&gt; Union[str, os.PathLike]
</span></div></code></pre>
<p><strong>æè¿°</strong>: ä¸‹è½½å¹¶ç¼“å­˜PyTorchæ‰©æ•£Pipelineçš„é¢„è®­ç»ƒPipelineæƒé‡ã€‚</p>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>pretrained_model_name</code> (<code>str</code> æˆ– <code>os.PathLike</code>, å¯é€‰): å­—ç¬¦ä¸²ï¼Œæ‰˜ç®¡åœ¨Hubä¸Šçš„é¢„è®­ç»ƒPipelineçš„<em>ä»“åº“id</em>ï¼ˆä¾‹å¦‚<code>CompVis/ldm-text2im-large-256</code>ï¼‰ã€‚</li>
<li><code>custom_pipeline</code> (<code>str</code>, å¯é€‰): å¯ä»¥æ˜¯ï¼š
<ul>
<li>å­—ç¬¦ä¸²ï¼Œæ‰˜ç®¡åœ¨Hubä¸Šçš„é¢„è®­ç»ƒPipelineçš„<em>ä»“åº“id</em>ï¼ˆä¾‹å¦‚<code>CompVis/ldm-text2im-large-256</code>ï¼‰ã€‚ä»“åº“å¿…é¡»åŒ…å«å®šä¹‰è‡ªå®šä¹‰Pipelineçš„<code>pipeline.py</code>æ–‡ä»¶ã€‚</li>
<li>å­—ç¬¦ä¸²ï¼Œæ‰˜ç®¡åœ¨GitHubä¸Š<a href="https://github.com/huggingface/diffusers/tree/main/examples/community">Community</a>ä¸‹çš„ç¤¾åŒºPipelineçš„<em>æ–‡ä»¶å</em>ã€‚æœ‰æ•ˆæ–‡ä»¶åå¿…é¡»åŒ¹é…æ–‡ä»¶åè€Œä¸æ˜¯Pipelineè„šæœ¬ï¼ˆ<code>clip_guided_stable_diffusion</code>è€Œä¸æ˜¯<code>clip_guided_stable_diffusion.py</code>ï¼‰ã€‚ç¤¾åŒºPipelineå§‹ç»ˆä»GitHubçš„å½“å‰<code>main</code>åˆ†æ”¯åŠ è½½ã€‚</li>
<li>åŒ…å«è‡ªå®šä¹‰Pipelineçš„<em>ç›®å½•</em>è·¯å¾„ï¼ˆ<code>./my_pipeline_directory/</code>ï¼‰ã€‚ç›®å½•å¿…é¡»åŒ…å«å®šä¹‰è‡ªå®šä¹‰Pipelineçš„<code>pipeline.py</code>æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<p><strong>è­¦å‘Š</strong>: ğŸ§ª è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œå¯èƒ½åœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ã€‚</p>
<p>æœ‰å…³å¦‚ä½•åŠ è½½å’Œåˆ›å»ºè‡ªå®šä¹‰Pipelineçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://huggingface.co/docs/diffusers/main/en/using-diffusers/contribute_pipeline">å¦‚ä½•è´¡çŒ®ç¤¾åŒºPipeline</a>ã€‚</p>
<ul>
<li><code>force_download</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): æ˜¯å¦å¼ºåˆ¶ï¼ˆé‡æ–°ï¼‰ä¸‹è½½æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ï¼Œè¦†ç›–ç¼“å­˜ç‰ˆæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</li>
<li><code>proxies</code> (<code>Dict[str, str]</code>, å¯é€‰): æŒ‰åè®®æˆ–ç«¯ç‚¹ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨å­—å…¸ï¼Œä¾‹å¦‚<code>{'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}</code>ã€‚ä»£ç†åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨ã€‚</li>
<li><code>output_loading_info</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): æ˜¯å¦è¿˜è¿”å›åŒ…å«ç¼ºå¤±é”®ã€æ„å¤–é”®å’Œé”™è¯¯æ¶ˆæ¯çš„å­—å…¸ã€‚</li>
<li><code>local_files_only</code> (<code>bool</code>, å¯é€‰, é»˜è®¤ä¸º <code>False</code>): æ˜¯å¦ä»…åŠ è½½æœ¬åœ°æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º<code>True</code>ï¼Œæ¨¡å‹ä¸ä¼šä»Hubä¸‹è½½ã€‚</li>
<li><code>token</code> (<code>str</code> æˆ– <code>bool</code>, å¯é€‰): ç”¨ä½œè¿œç¨‹æ–‡ä»¶HTTP beareræˆæƒçš„ä»¤ç‰Œã€‚å¦‚æœä¸º<code>True</code>ï¼Œåˆ™ä½¿ç”¨ä»<code>diffusers-cli login</code>ç”Ÿæˆçš„ä»¤ç‰Œï¼ˆå­˜å‚¨åœ¨<code>~/.huggingface</code>ä¸­ï¼‰ã€‚</li>
<li><code>revision</code> (<code>str</code>, å¯é€‰, é»˜è®¤ä¸º <code>&quot;main&quot;</code>): è¦ä½¿ç”¨çš„ç‰¹å®šæ¨¡å‹ç‰ˆæœ¬ã€‚å¯ä»¥æ˜¯åˆ†æ”¯åç§°ã€æ ‡ç­¾åç§°ã€æäº¤idæˆ–Gitå…è®¸çš„ä»»ä½•æ ‡è¯†ç¬¦ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼</strong>: ä¸‹è½½çš„æ¨¡å‹è·¯å¾„</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># ä¸‹è½½æ¨¡å‹åˆ°ç¼“å­˜</span>
model_path = DiffusionPipeline.download(<span class="hljs-string">"stable-diffusion-v1-5/stable-diffusion-v1-5"</span>)
print(<span class="hljs-string">f"æ¨¡å‹ä¸‹è½½åˆ°: <span class="hljs-subst">{model_path}</span>"</span>)
</div></code></pre>
<h2 id="%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E5%99%A8">å±æ€§è®¿é—®å™¨</h2>
<h3 id="16-device-%E5%B1%9E%E6%80%A7">16. <code>device</code> å±æ€§</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">device</span><span class="hljs-params">(self)</span> -&gt; torch.device
</span></div></code></pre>
<p><strong>æè¿°</strong>: è¿”å›Pipelineæ‰€åœ¨çš„torchè®¾å¤‡ã€‚</p>
<p><strong>è¿”å›å€¼</strong>: <code>torch.device</code>: Pipelineæ‰€åœ¨çš„torchè®¾å¤‡ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div>print(<span class="hljs-string">f"Pipelineåœ¨è®¾å¤‡: <span class="hljs-subst">{pipeline.device}</span>"</span>)
<span class="hljs-comment"># è¾“å‡º: Pipelineåœ¨è®¾å¤‡: cuda:0</span>
</div></code></pre>
<hr>
<h3 id="17-dtype-%E5%B1%9E%E6%80%A7">17. <code>dtype</code> å±æ€§</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dtype</span><span class="hljs-params">(self)</span> -&gt; torch.dtype
</span></div></code></pre>
<p><strong>æè¿°</strong>: è¿”å›Pipelineæ‰€åœ¨çš„torch dtypeã€‚</p>
<p><strong>è¿”å›å€¼</strong>: <code>torch.dtype</code>: Pipelineæ‰€åœ¨çš„torch dtypeã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div>print(<span class="hljs-string">f"Pipelineæ•°æ®ç±»å‹: <span class="hljs-subst">{pipeline.dtype}</span>"</span>)
<span class="hljs-comment"># è¾“å‡º: Pipelineæ•°æ®ç±»å‹: torch.float16</span>
</div></code></pre>
<hr>
<h3 id="18-components-%E5%B1%9E%E6%80%A7">18. <code>components</code> å±æ€§</h3>
<pre class="hljs"><code><div><span class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">components</span><span class="hljs-params">(self)</span> -&gt; Dict[str, Any]
</span></div></code></pre>
<p><strong>æè¿°</strong>: <code>self.components</code>å±æ€§å¯¹äºä½¿ç”¨ç›¸åŒæƒé‡å’Œé…ç½®è¿è¡Œä¸åŒPipelineè€Œä¸é‡æ–°åˆ†é…é¢å¤–å†…å­˜å¾ˆæœ‰ç”¨ã€‚</p>
<p><strong>è¿”å›å€¼</strong> (<code>dict</code>): åŒ…å«æ‰€æœ‰Pipelineç»„ä»¶çš„å­—å…¸ï¼Œå…¶ä¸­é”®æ˜¯ç»„ä»¶åç§°ï¼Œå€¼æ˜¯ç»„ä»¶å®ä¾‹ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre class="hljs"><code><div>components = pipeline.components
print(<span class="hljs-string">"Pipelineç»„ä»¶:"</span>, list(components.keys()))
<span class="hljs-comment"># è¾“å‡º: Pipelineç»„ä»¶: ['vae', 'text_encoder', 'tokenizer', 'unet', 'scheduler']</span>

<span class="hljs-comment"># ä½¿ç”¨ç»„ä»¶åˆ›å»ºæ–°Pipeline</span>
new_pipeline = AnotherPipeline(**components)
</div></code></pre>

</body>
</html>
